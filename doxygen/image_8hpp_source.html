<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ISIS Core Library: /scr/thulium1/isis/lib/Core/DataStorage/image.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>/scr/thulium1/isis/lib/Core/DataStorage/image.hpp</h1>  </div>
</div>
<div class="contents">
<a href="image_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// C++ Interface: image</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// Description:</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">//</span>
<a name="l00007"></a>00007 <span class="comment">// Author: Enrico Reimer&lt;reimer@cbs.mpg.de&gt;, (C) 2009</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 <span class="comment">// Copyright: See COPYING file that comes with this distribution</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">//</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#ifndef IMAGE_H</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">#define IMAGE_H</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="chunk_8hpp.html">chunk.hpp</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;boost/shared_ptr.hpp&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;boost/foreach.hpp&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;boost/numeric/ublas/matrix.hpp&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;stack&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="sortedchunklist_8hpp.html">sortedchunklist.hpp</a>&quot;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">namespace </span>isis
<a name="l00027"></a>00027 {
<a name="l00028"></a>00028 <span class="keyword">namespace </span>data
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="classisis_1_1data_1_1Image.html">00031</a> <span class="keyword">class </span><a class="code" href="classisis_1_1data_1_1Image.html">Image</a>:
<a name="l00032"></a>00032     <span class="keyword">public</span> _internal::NDimensional&lt;4&gt;,
<a name="l00033"></a>00033     <span class="keyword">public</span> util::PropertyMap
<a name="l00034"></a>00034 {
<a name="l00035"></a>00035 <span class="keyword">public</span>:
<a name="l00036"></a><a class="code" href="classisis_1_1data_1_1Image.html#ac83f7eecffd172b0c0759cb5ee7dd633a0d4cbf4f6526d1d6895c71e6bea6542c">00036</a>     <span class="keyword">enum</span> <a class="code" href="classisis_1_1data_1_1Image.html#ac83f7eecffd172b0c0759cb5ee7dd633">orientation</a> {axial, reversed_axial, sagittal, reversed_sagittal, coronal, <a class="code" href="classisis_1_1data_1_1Image.html#ac83f7eecffd172b0c0759cb5ee7dd633af6335ced67866cc519e297f42ee64caa">reversed_coronal</a>};
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="keyword">protected</span>:
<a name="l00039"></a><a class="code" href="classisis_1_1data_1_1Image.html#af3656b415fa1872a8da29f82cb98ed6e">00039</a>     <a class="code" href="classisis_1_1data_1_1__internal_1_1SortedChunkList.html">_internal::SortedChunkList</a> <span class="keyword">set</span>;
<a name="l00040"></a><a class="code" href="classisis_1_1data_1_1Image.html#a9c80a4fa8768d5df1c8bf67129e2cae9">00040</a>     std::vector&lt;boost::shared_ptr&lt;Chunk&gt; &gt; <a class="code" href="classisis_1_1data_1_1Image.html#a9c80a4fa8768d5df1c8bf67129e2cae9">lookup</a>;
<a name="l00041"></a>00041 <span class="keyword">private</span>:
<a name="l00042"></a>00042     <span class="keywordtype">bool</span> clean;
<a name="l00043"></a>00043     <span class="keywordtype">size_t</span> chunkVolume;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045     <span class="keywordtype">void</span> deduplicateProperties();
<a name="l00046"></a>00046 
<a name="l00052"></a>00052     <span class="keyword">const</span> boost::shared_ptr&lt;Chunk&gt; &amp;chunkPtrAt( <span class="keywordtype">size_t</span> at )<span class="keyword">const</span>;
<a name="l00053"></a>00053 
<a name="l00065"></a>00065     <span class="keyword">inline</span> std::pair&lt;size_t, size_t&gt; commonGet ( <span class="keywordtype">size_t</span> first, <span class="keywordtype">size_t</span> second, <span class="keywordtype">size_t</span> third, <span class="keywordtype">size_t</span> fourth )<span class="keyword"> const </span>{
<a name="l00066"></a>00066         <span class="keyword">const</span> <span class="keywordtype">size_t</span> idx[] = {first, second, third, fourth};
<a name="l00067"></a>00067         <a class="code" href="log_8hpp.html#a977f6c27373576d6ffe1523fc2afb8b6">LOG_IF</a>( ! clean, <a class="code" href="namespaceisis_1_1data.html#a1fa5e73edba41053e31839cba7134dbd">Debug</a>, <a class="code" href="group__util.html#ggafe55030315ca143f9be26fd278df9f82a41a0a4591faa6079940551ad22c43597">error</a> )
<a name="l00068"></a>00068                 &lt;&lt; <span class="stringliteral">&quot;Getting data from a non indexed image will result in undefined behavior. Run reIndex first.&quot;</span>;
<a name="l00069"></a>00069         <a class="code" href="log_8hpp.html#a977f6c27373576d6ffe1523fc2afb8b6">LOG_IF</a>( <span class="keyword">set</span>.<a class="code" href="classisis_1_1data_1_1Image.html#a9fb0c9f8351fddc6a2fea609d487aa2b">isEmpty</a>(), <a class="code" href="namespaceisis_1_1data.html#a1fa5e73edba41053e31839cba7134dbd">Debug</a>, <a class="code" href="group__util.html#ggafe55030315ca143f9be26fd278df9f82a41a0a4591faa6079940551ad22c43597">error</a> )
<a name="l00070"></a>00070                 &lt;&lt; <span class="stringliteral">&quot;Getting data from a empty image will result in undefined behavior.&quot;</span>;
<a name="l00071"></a>00071         <a class="code" href="log_8hpp.html#a977f6c27373576d6ffe1523fc2afb8b6">LOG_IF</a>( !<a class="code" href="classisis_1_1data_1_1__internal_1_1NDimensional.html#a25357b6c09d29da78456e2c2504d479e" title="Check if index fits into the dimensional size of the object.">isInRange</a>( idx ), <a class="code" href="namespaceisis_1_1data.html#a1fa5e73edba41053e31839cba7134dbd">Debug</a>, <a class="code" href="group__util.html#ggafe55030315ca143f9be26fd278df9f82a41a0a4591faa6079940551ad22c43597">isis::error</a> )
<a name="l00072"></a>00072                 &lt;&lt; <span class="stringliteral">&quot;Index &quot;</span> &lt;&lt; <a class="code" href="namespaceisis_1_1util.html#a8eedeaea8a5e6fb7849880fc5b4d4648" title="use listToOStream to create a string from a list">util::listToString</a>( idx, idx + 4, <span class="stringliteral">&quot;|&quot;</span> ) &lt;&lt; <span class="stringliteral">&quot; is out of range (&quot;</span> &lt;&lt; <a class="code" href="classisis_1_1data_1_1__internal_1_1NDimensional.html#a5987df3c819b04abd031e0049a87f3e7" title="generates a string representing the size">getSizeAsString</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;
<a name="l00073"></a>00073         <span class="keyword">const</span> <span class="keywordtype">size_t</span> index = <a class="code" href="classisis_1_1data_1_1__internal_1_1NDimensional.html#ada01b000f0bccc84df97c149b4b827e0" title="Compute linear index from n-dimensional index,.">getLinearIndex</a>( idx );
<a name="l00074"></a>00074         <span class="keywordflow">return</span> std::make_pair( index / chunkVolume, index % chunkVolume );
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="keyword">protected</span>:
<a name="l00079"></a><a class="code" href="classisis_1_1data_1_1Image.html#a8f9c4e537ac029bc07d10ded62d0be32">00079</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classisis_1_1data_1_1Image.html#a8f9c4e537ac029bc07d10ded62d0be32">neededProperties</a>;
<a name="l00080"></a>00080 
<a name="l00099"></a>00099     <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#aece4ae886cea93d0e05087c9b3e2c85b" title="Search for a dimensional break in all stored chunks.">getChunkStride</a>( <span class="keywordtype">size_t</span> base_stride = 1 );
<a name="l00105"></a>00105     <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> &amp;<a class="code" href="classisis_1_1data_1_1Image.html#a087ed8c4884cea467e47c386c65d5be2" title="Access a chunk via index (and the lookup table) The Chunk will only have metadata which are unique to...">chunkAt</a>( <span class="keywordtype">size_t</span> at );
<a name="l00107"></a>00107     <a class="code" href="classisis_1_1data_1_1Image.html#afe4f8006b3f04f60f68b5027ed8bbebc" title="Creates an empty Image object.">Image</a>();
<a name="l00108"></a>00108 <span class="keyword">public</span>:
<a name="l00109"></a><a class="code" href="classisis_1_1data_1_1Image_1_1ChunkOp.html">00109</a>     <span class="keyword">class </span><a class="code" href="classisis_1_1data_1_1Image_1_1ChunkOp.html">ChunkOp</a> : std::unary_function&lt;Chunk &amp;, bool&gt;
<a name="l00110"></a>00110     {
<a name="l00111"></a>00111     <span class="keyword">public</span>:
<a name="l00112"></a>00112         <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classisis_1_1data_1_1Image_1_1ChunkOp.html#a2b62dc0a18aa391fc367861ed5c36986">operator()</a>( <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> &amp;, <a class="code" href="classisis_1_1util_1_1FixedVector.html">util::FixedVector&lt;size_t, 4&gt;</a> posInImage ) = 0;
<a name="l00113"></a>00113     };
<a name="l00114"></a>00114 
<a name="l00119"></a>00119     <a class="code" href="classisis_1_1data_1_1Image.html#afe4f8006b3f04f60f68b5027ed8bbebc" title="Creates an empty Image object.">Image</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Image.html">Image</a> &amp;ref );
<a name="l00120"></a>00120 
<a name="l00125"></a><a class="code" href="classisis_1_1data_1_1Image.html#a12e82fed1ce3688fd3cb93ec04eb59a5">00125</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="classisis_1_1data_1_1Image.html#a12e82fed1ce3688fd3cb93ec04eb59a5" title="Create image from a list of Chunks or objects with the base Chunk.">Image</a>( std::list&lt;T&gt; &amp;chunks ) : _internal::<a class="code" href="classisis_1_1data_1_1__internal_1_1NDimensional.html#a3176ed9830494aed59c944eef256bf1b">NDimensional</a>&lt;4&gt;(), util::<a class="code" href="classisis_1_1util_1_1PropertyMap.html#afcc2f4657fbd500284e60e0ef442bbe6">PropertyMap</a>(), <a class="code" href="classisis_1_1data_1_1Image.html#af3656b415fa1872a8da29f82cb98ed6e">set</a>( <span class="stringliteral">&quot;sequenceNumber,rowVec,columnVec,sliceVec,coilChannelMask,DICOM/EchoNumbers&quot;</span> ), clean( false ) {
<a name="l00126"></a>00126         BOOST_STATIC_ASSERT( ( boost::is_base_of&lt;Chunk, T&gt;::value ) );
<a name="l00127"></a>00127         <a class="code" href="classisis_1_1util_1_1PropertyMap.html#afc8dc03ba6f2f6988b133ab57e1aa26c" title="Make Properties given by a space separated list needed.">addNeededFromString</a>( <a class="code" href="classisis_1_1data_1_1Image.html#a8f9c4e537ac029bc07d10ded62d0be32">neededProperties</a> );
<a name="l00128"></a>00128         <span class="keyword">set</span>.addSecondarySort( <span class="stringliteral">&quot;acquisitionNumber&quot;</span> );
<a name="l00129"></a>00129         <span class="keyword">set</span>.addSecondarySort( <span class="stringliteral">&quot;acquisitionTime&quot;</span> );
<a name="l00130"></a>00130 
<a name="l00131"></a>00131         <span class="keywordtype">size_t</span> cnt = 0;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="keywordflow">for</span> ( <span class="keyword">typename</span> std::list&lt;T&gt;::iterator i = chunks.begin(); i != chunks.end(); ) { <span class="comment">// for all remaining chunks</span>
<a name="l00134"></a>00134             <span class="keywordflow">if</span> ( <a class="code" href="classisis_1_1data_1_1Image.html#a14a33c4d2ba857b38c2188fb8e8abfd9" title="Insert a Chunk into the Image.">insertChunk</a>( *i ) ) {
<a name="l00135"></a>00135                 chunks.erase( i++ );
<a name="l00136"></a>00136                 cnt++;
<a name="l00137"></a>00137             } <span class="keywordflow">else</span> {
<a name="l00138"></a>00138                 i++;
<a name="l00139"></a>00139             }
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         <span class="keywordflow">if</span> ( ! <a class="code" href="classisis_1_1data_1_1Image.html#a9fb0c9f8351fddc6a2fea609d487aa2b">isEmpty</a>() ) {
<a name="l00143"></a>00143             <a class="code" href="log_8hpp.html#adf04aa30f03b88d867f551c7d349f738">LOG</a>( <a class="code" href="namespaceisis_1_1data.html#a1fa5e73edba41053e31839cba7134dbd">Debug</a>, <a class="code" href="group__util.html#ggafe55030315ca143f9be26fd278df9f82ad97a38c0fafe61d63fdb883c85d0067a">info</a> ) &lt;&lt; <span class="stringliteral">&quot;Reindexing image with &quot;</span> &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot; chunks.&quot;</span>;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145             <span class="keywordflow">if</span>( !<a class="code" href="classisis_1_1data_1_1Image.html#a801a02eb15ae94b384aaa97061e2ad1c" title="(Re)computes the image layout and metadata.">reIndex</a>() ) {
<a name="l00146"></a>00146                 <a class="code" href="log_8hpp.html#adf04aa30f03b88d867f551c7d349f738">LOG</a>( <a class="code" href="namespaceisis_1_1data.html#a15b301b1e8962fdf9562e683d7be5d9f">Runtime</a>, <a class="code" href="group__util.html#ggafe55030315ca143f9be26fd278df9f82a41a0a4591faa6079940551ad22c43597">error</a> ) &lt;&lt; <span class="stringliteral">&quot;Failed to create image from &quot;</span> &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot; chunks.&quot;</span>;
<a name="l00147"></a>00147             } <span class="keywordflow">else</span> {
<a name="l00148"></a>00148                 <a class="code" href="log_8hpp.html#a977f6c27373576d6ffe1523fc2afb8b6">LOG_IF</a>( !<a class="code" href="classisis_1_1util_1_1PropertyMap.html#ad84de96685231d402bf9e8741a72db91" title="Get a list of missing properties.">getMissing</a>().empty(), <a class="code" href="namespaceisis_1_1data.html#a1fa5e73edba41053e31839cba7134dbd">Debug</a>, <a class="code" href="group__util.html#ggafe55030315ca143f9be26fd278df9f82a5e3b72b2efcd89afa9487c776fb12d19">warning</a> )
<a name="l00149"></a>00149                         &lt;&lt; <span class="stringliteral">&quot;The created image is missing some properties: &quot;</span> &lt;&lt; <a class="code" href="classisis_1_1util_1_1PropertyMap.html#ad84de96685231d402bf9e8741a72db91" title="Get a list of missing properties.">getMissing</a>() &lt;&lt; <span class="stringliteral">&quot;. It will be invalid.&quot;</span>;
<a name="l00150"></a>00150             }
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 
<a name="l00158"></a>00158     <a class="code" href="classisis_1_1data_1_1Image.html#afe4f8006b3f04f60f68b5027ed8bbebc" title="Creates an empty Image object.">Image</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> &amp;chunk );
<a name="l00159"></a>00159 
<a name="l00164"></a>00164     <a class="code" href="classisis_1_1data_1_1Image.html">Image</a> &amp;<a class="code" href="classisis_1_1data_1_1Image.html#aae95616fad335432d8ce3b5e5daf004a" title="Copy operator.">operator=</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Image.html">Image</a> &amp;ref );
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="keywordtype">bool</span> <a class="code" href="classisis_1_1data_1_1Image.html#acd213fa6d0856d45e6413801f9bdec66">checkMakeClean</a>();
<a name="l00167"></a>00167     <span class="keywordtype">bool</span> <a class="code" href="classisis_1_1data_1_1Image.html#a904fef2b4511f9c978be51bf9b7fe8f1">isClean</a>();
<a name="l00185"></a><a class="code" href="classisis_1_1data_1_1Image.html#a31aecea5e2a012d677c59222ebe13198">00185</a>     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; T &amp;<a class="code" href="classisis_1_1data_1_1Image.html#a31aecea5e2a012d677c59222ebe13198" title="This method returns a reference to the voxel value at the given coordinates.">voxel</a>( <span class="keywordtype">size_t</span> first, <span class="keywordtype">size_t</span> second = 0, <span class="keywordtype">size_t</span> third = 0, <span class="keywordtype">size_t</span> fourth = 0 ) {
<a name="l00186"></a>00186         <a class="code" href="classisis_1_1data_1_1Image.html#acd213fa6d0856d45e6413801f9bdec66">checkMakeClean</a>();
<a name="l00187"></a>00187         <span class="keyword">const</span> std::pair&lt;size_t, size_t&gt; index = commonGet( first, second, third, fourth );
<a name="l00188"></a>00188         <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">ValuePtr&lt;T&gt;</a> &amp;data = <a class="code" href="classisis_1_1data_1_1Image.html#a087ed8c4884cea467e47c386c65d5be2" title="Access a chunk via index (and the lookup table) The Chunk will only have metadata which are unique to...">chunkAt</a>( index.first ).<a class="code" href="classisis_1_1data_1_1Chunk.html#a606c40ac8393596b16dcd2a07ec6f8f2">asValuePtr</a>&lt;T&gt;();
<a name="l00189"></a>00189         <span class="keywordflow">return</span> data[index.second];
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00204"></a><a class="code" href="classisis_1_1data_1_1Image.html#a907da37c72907fa34c67ed937a34c83a">00204</a>     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">const</span> T &amp;<a class="code" href="classisis_1_1data_1_1Image.html#a907da37c72907fa34c67ed937a34c83a" title="Get a const reference to the voxel value at the given coordinates.">voxel</a>( <span class="keywordtype">size_t</span> first, <span class="keywordtype">size_t</span> second = 0, <span class="keywordtype">size_t</span> third = 0, <span class="keywordtype">size_t</span> fourth = 0 )<span class="keyword">const </span>{
<a name="l00205"></a>00205         <span class="keyword">const</span> std::pair&lt;size_t, size_t&gt; index = commonGet( first, second, third, fourth );
<a name="l00206"></a>00206         <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">ValuePtr&lt;T&gt;</a> &amp;data = chunkPtrAt( index.first )-&gt;getValuePtr&lt;T&gt;();
<a name="l00207"></a>00207         <span class="keywordflow">return</span> data[index.second];
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 
<a name="l00221"></a>00221     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classisis_1_1data_1_1Image.html#a601eaac6eedf7eaf6fdb6c31b1e8765d" title="Get the type of the chunk with &amp;quot;biggest&amp;quot; type.">getMajorTypeID</a>() <span class="keyword">const</span>;
<a name="l00223"></a>00223     std::string <a class="code" href="classisis_1_1data_1_1Image.html#a6d5302c9e0de9fe8c97fbafa4a9e2d1e">getMajorTypeName</a>() <span class="keyword">const</span>;
<a name="l00224"></a>00224 
<a name="l00230"></a>00230     <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> <a class="code" href="classisis_1_1data_1_1Image.html#a27cfa5f9ced2077e578ad4bcc064e028" title="Get a chunk via index (and the lookup table).">getChunkAt</a>( <span class="keywordtype">size_t</span> at, <span class="keywordtype">bool</span> copy_metadata = <span class="keyword">true</span> )<span class="keyword">const</span>;
<a name="l00231"></a>00231 
<a name="l00245"></a>00245     <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> <a class="code" href="classisis_1_1data_1_1Image.html#afda7218833647cc6526950524775140d" title="Get the chunk that contains the voxel at the given coordinates.">getChunk</a>( <span class="keywordtype">size_t</span> first, <span class="keywordtype">size_t</span> second = 0, <span class="keywordtype">size_t</span> third = 0, <span class="keywordtype">size_t</span> fourth = 0, <span class="keywordtype">bool</span> copy_metadata = <span class="keyword">true</span> )<span class="keyword">const</span>;
<a name="l00246"></a>00246 
<a name="l00259"></a>00259     <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> <a class="code" href="classisis_1_1data_1_1Image.html#afda7218833647cc6526950524775140d" title="Get the chunk that contains the voxel at the given coordinates.">getChunk</a>( <span class="keywordtype">size_t</span> first, <span class="keywordtype">size_t</span> second = 0, <span class="keywordtype">size_t</span> third = 0, <span class="keywordtype">size_t</span> fourth = 0, <span class="keywordtype">bool</span> copy_metadata = <span class="keyword">true</span> );
<a name="l00260"></a>00260 
<a name="l00266"></a>00266     std::vector&lt;boost::shared_ptr&lt;Chunk&gt; &gt; <a class="code" href="classisis_1_1data_1_1Image.html#aecd5440f8550637ddb9f582f5ac7802f" title="Get a sorted list of pointers to the chunks of the image.">getChunksAsVector</a>();
<a name="l00267"></a>00267 
<a name="l00269"></a>00269     std::vector&lt;boost::shared_ptr&lt;const Chunk&gt; &gt; <a class="code" href="classisis_1_1data_1_1Image.html#aecd5440f8550637ddb9f582f5ac7802f" title="Get a sorted list of pointers to the chunks of the image.">getChunksAsVector</a>()<span class="keyword">const</span>;
<a name="l00270"></a>00270 
<a name="l00284"></a><a class="code" href="classisis_1_1data_1_1Image.html#a815e76cb9cc68006b2bbdad2cd9ded7c">00284</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> TYPE&gt; <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> <a class="code" href="classisis_1_1data_1_1Image.html#a815e76cb9cc68006b2bbdad2cd9ded7c" title="Get the chunk that contains the voxel at the given coordinates in the given type.">getChunkAs</a>( <span class="keywordtype">size_t</span> first, <span class="keywordtype">size_t</span> second = 0, <span class="keywordtype">size_t</span> third = 0, <span class="keywordtype">size_t</span> fourth = 0, <span class="keywordtype">bool</span> copy_metadata = <span class="keyword">true</span> )<span class="keyword">const </span>{
<a name="l00285"></a>00285         <span class="keywordflow">return</span> getChunkAs&lt;TYPE&gt;( <a class="code" href="classisis_1_1data_1_1Image.html#a789138e66345f3e5a73c65dbf05b2940" title="for each chunk get the scaling (and offset) which would be used in an conversion to the given type...">getScalingTo</a>( <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">ValuePtr&lt;TYPE&gt;::staticID</a> ), first, second, third, fourth, copy_metadata );
<a name="l00286"></a>00286     }
<a name="l00299"></a><a class="code" href="classisis_1_1data_1_1Image.html#a72a398bd1f12cb27bc33bf0e1c693995">00299</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> TYPE&gt; <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> <a class="code" href="classisis_1_1data_1_1Image.html#a72a398bd1f12cb27bc33bf0e1c693995" title="Get the chunk that contains the voxel at the given coordinates in the given type (fast version)...">getChunkAs</a>( <span class="keyword">const</span> <a class="code" href="namespaceisis_1_1data.html#ac2873e5e7a9637d4ac68253dcf140ff4">scaling_pair</a> &amp;scaling, <span class="keywordtype">size_t</span> first, <span class="keywordtype">size_t</span> second = 0, <span class="keywordtype">size_t</span> third = 0, <span class="keywordtype">size_t</span> fourth = 0, <span class="keywordtype">bool</span> copy_metadata = <span class="keyword">true</span> )<span class="keyword">const </span>{
<a name="l00300"></a>00300         <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> ret = <a class="code" href="classisis_1_1data_1_1Image.html#afda7218833647cc6526950524775140d" title="Get the chunk that contains the voxel at the given coordinates.">getChunk</a>( first, second, third, fourth, copy_metadata ); <span class="comment">// get a cheap copy</span>
<a name="l00301"></a>00301         ret.<a class="code" href="classisis_1_1data_1_1Chunk.html#ab1244bb372b89f0221503edd728a1893" title="Ensure, the chunk has the type with the requested ID.">convertToType</a>( <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">ValuePtr&lt;TYPE&gt;::staticID</a>, scaling ); <span class="comment">// make it of type T</span>
<a name="l00302"></a>00302         <span class="keywordflow">return</span> ret; <span class="comment">//return that</span>
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304 
<a name="l00306"></a>00306     <a class="code" href="namespaceisis_1_1data.html#ac2873e5e7a9637d4ac68253dcf140ff4">scaling_pair</a> <a class="code" href="classisis_1_1data_1_1Image.html#a789138e66345f3e5a73c65dbf05b2940" title="for each chunk get the scaling (and offset) which would be used in an conversion to the given type...">getScalingTo</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> typeID, <a class="code" href="namespaceisis_1_1data.html#a69354ef53dcb79cbe577ae5fe8764e49">autoscaleOption</a> scaleopt = <a class="code" href="namespaceisis_1_1data.html#a69354ef53dcb79cbe577ae5fe8764e49a3a9ca3fecf5ccbb0f9d787d31a9edd2f">autoscale</a> )<span class="keyword">const</span>;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 
<a name="l00317"></a>00317     <span class="keywordtype">bool</span> <a class="code" href="classisis_1_1data_1_1Image.html#a14a33c4d2ba857b38c2188fb8e8abfd9" title="Insert a Chunk into the Image.">insertChunk</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> &amp;chunk );
<a name="l00323"></a>00323     <span class="keywordtype">bool</span> <a class="code" href="classisis_1_1data_1_1Image.html#a801a02eb15ae94b384aaa97061e2ad1c" title="(Re)computes the image layout and metadata.">reIndex</a>();
<a name="l00324"></a>00324 
<a name="l00326"></a>00326     <span class="keywordtype">bool</span> <a class="code" href="classisis_1_1data_1_1Image.html#a9fb0c9f8351fddc6a2fea609d487aa2b">isEmpty</a>()<span class="keyword">const</span>;
<a name="l00327"></a>00327 
<a name="l00333"></a>00333     std::list&lt;util::PropertyValue&gt; <a class="code" href="classisis_1_1data_1_1Image.html#a97524a597e61074c8b4b2e6e0ebdf8e6" title="Get a list of the properties of the chunks for the given key.">getChunksProperties</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1util_1_1PropertyMap.html#a22562fc95dac243746790a5c6a2aad85" title="type of the used keys">util::PropertyMap::KeyType</a> &amp;key, <span class="keywordtype">bool</span> unique = <span class="keyword">false</span> )<span class="keyword">const</span>;
<a name="l00334"></a>00334 
<a name="l00336"></a>00336     <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#a873a72def2728e8cfc060ee8c6ac6bd3" title="get the size of every voxel (in bytes)">getBytesPerVoxel</a>()<span class="keyword">const</span>;
<a name="l00337"></a>00337 
<a name="l00343"></a><a class="code" href="classisis_1_1data_1_1Image.html#ae4bef75405f6729ab6c81191dc23bfc0">00343</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; std::pair&lt;T, T&gt; <a class="code" href="classisis_1_1data_1_1Image.html#ae4bef75405f6729ab6c81191dc23bfc0" title="Get the maximum and the minimum voxel value of the image.">getMinMaxAs</a>()<span class="keyword">const </span>{
<a name="l00344"></a>00344         <a class="code" href="structisis_1_1util_1_1checkType.html" title="Templated pseudo struct to check for availability of a type at compile time.">util::checkType&lt;T&gt;</a>();<span class="comment">// works only for T from _internal::types</span>
<a name="l00345"></a>00345         std::pair&lt;util::ValueReference, util::ValueReference&gt; minmax = <a class="code" href="classisis_1_1data_1_1Image.html#ab437a008e59944a63c9fdc844c673ad6" title="Get the maximum and the minimum voxel value of the image as a pair of ValueReference-objects.">getMinMax</a>();
<a name="l00346"></a>00346         <span class="keywordflow">return</span> std::make_pair( minmax.first-&gt;as&lt;T&gt;(), minmax.second-&gt;as&lt;T&gt;() );
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 
<a name="l00350"></a>00350     std::pair&lt;util::ValueReference, util::ValueReference&gt; <a class="code" href="classisis_1_1data_1_1Image.html#ab437a008e59944a63c9fdc844c673ad6" title="Get the maximum and the minimum voxel value of the image as a pair of ValueReference-objects.">getMinMax</a>()<span class="keyword">const</span>;
<a name="l00351"></a>00351 
<a name="l00356"></a>00356     <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#a0750957ebf3422a0fbb3d029cc9b292a" title="Compares the voxel-values of this image to the given.">compare</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Image.html">Image</a> &amp;comp )<span class="keyword">const</span>;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <a class="code" href="classisis_1_1data_1_1Image.html#ac83f7eecffd172b0c0759cb5ee7dd633">orientation</a> <a class="code" href="classisis_1_1data_1_1Image.html#a5d4c287dbd53f05174f3070029e19ce9">getMainOrientation</a>()<span class="keyword">const</span>;
<a name="l00371"></a><a class="code" href="classisis_1_1data_1_1Image.html#a9ed78842da8e8f0af4f2f14d71dae2ee">00371</a>     <span class="keywordtype">void</span> <a class="code" href="classisis_1_1data_1_1Image.html#a9ed78842da8e8f0af4f2f14d71dae2ee" title="Transforms the image coordinate system into an other system by multiplying the orientation matrix wit...">transformCoords</a>( boost::numeric::ublas::matrix&lt;float&gt; transform_matrix ) {
<a name="l00372"></a>00372         <a class="code" href="classisis_1_1data_1_1Image.html#a9ed78842da8e8f0af4f2f14d71dae2ee" title="Transforms the image coordinate system into an other system by multiplying the orientation matrix wit...">isis::data::_internal::transformCoords</a>( *<span class="keyword">this</span>, transform_matrix );
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 
<a name="l00379"></a><a class="code" href="classisis_1_1data_1_1Image.html#a6828f1a6b951b3e171152287fd4a6184">00379</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="classisis_1_1data_1_1Image.html#a6828f1a6b951b3e171152287fd4a6184" title="Copy all voxel data of the image into memory.">copyToMem</a>( T *dst )<span class="keyword">const </span>{
<a name="l00380"></a>00380         <span class="keywordflow">if</span>( clean ) {
<a name="l00381"></a>00381             <a class="code" href="namespaceisis_1_1data.html#ac2873e5e7a9637d4ac68253dcf140ff4">scaling_pair</a> scale = <a class="code" href="classisis_1_1data_1_1Image.html#a789138e66345f3e5a73c65dbf05b2940" title="for each chunk get the scaling (and offset) which would be used in an conversion to the given type...">getScalingTo</a>( <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">ValuePtr&lt;T&gt;::staticID</a> );
<a name="l00382"></a>00382             <span class="comment">// we could do this using convertToType - but this solution does not need any additional temporary memory</span>
<a name="l00383"></a>00383             BOOST_FOREACH( <span class="keyword">const</span> boost::shared_ptr&lt;Chunk&gt; &amp;ref, <a class="code" href="classisis_1_1data_1_1Image.html#a9c80a4fa8768d5df1c8bf67129e2cae9">lookup</a> ) {
<a name="l00384"></a>00384                 <span class="keywordflow">if</span>( !ref-&gt;copyToMem&lt;T&gt;( dst, scale ) ) {
<a name="l00385"></a>00385                     <a class="code" href="log_8hpp.html#adf04aa30f03b88d867f551c7d349f738">LOG</a>( <a class="code" href="namespaceisis_1_1data.html#a15b301b1e8962fdf9562e683d7be5d9f">Runtime</a>, <a class="code" href="group__util.html#ggafe55030315ca143f9be26fd278df9f82a41a0a4591faa6079940551ad22c43597">error</a> ) &lt;&lt; <span class="stringliteral">&quot;Failed to copy raw data of type &quot;</span> &lt;&lt; ref-&gt;getTypeName() &lt;&lt; <span class="stringliteral">&quot; from image into memory of type &quot;</span> &lt;&lt; <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">ValuePtr&lt;T&gt;::staticName</a>();
<a name="l00386"></a>00386                 }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388                 dst += ref-&gt;getVolume(); <span class="comment">// increment the cursor</span>
<a name="l00389"></a>00389             }
<a name="l00390"></a>00390         } <span class="keywordflow">else</span> {
<a name="l00391"></a>00391             <a class="code" href="log_8hpp.html#adf04aa30f03b88d867f551c7d349f738">LOG</a>( <a class="code" href="namespaceisis_1_1data.html#a15b301b1e8962fdf9562e683d7be5d9f">Runtime</a>, <a class="code" href="group__util.html#ggafe55030315ca143f9be26fd278df9f82a41a0a4591faa6079940551ad22c43597">error</a> ) &lt;&lt; <span class="stringliteral">&quot;Cannot copy from non clean images. Run reIndex first&quot;</span>;
<a name="l00392"></a>00392         }
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394 
<a name="l00401"></a><a class="code" href="classisis_1_1data_1_1Image.html#ad4c4bf9e84ee707c221cb5140cfb8f3f">00401</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="classisis_1_1data_1_1MemChunk.html" title="Chunk class for memory-based buffers.">MemChunk&lt;T&gt;</a> <a class="code" href="classisis_1_1data_1_1Image.html#ad4c4bf9e84ee707c221cb5140cfb8f3f" title="Copy all voxel data into a new MemChunk.">copyToMemChunk</a>()<span class="keyword">const </span>{
<a name="l00402"></a>00402         <span class="keyword">const</span> <a class="code" href="classisis_1_1util_1_1FixedVector.html">util::FixedVector&lt;size_t, 4&gt;</a> size = <a class="code" href="classisis_1_1data_1_1__internal_1_1NDimensional.html#a498b4ebaa5ef654ebe41eacebe813e66" title="generates a FixedVector&amp;lt;DIMS&amp;gt; representing the size">getSizeAsVector</a>();
<a name="l00403"></a>00403         <a class="code" href="classisis_1_1data_1_1MemChunk.html" title="Chunk class for memory-based buffers.">data::MemChunk&lt;T&gt;</a> ret( size[0], size[1], size[2], size[3] );
<a name="l00404"></a>00404         copyToMem&lt;T&gt;( &amp;ret.<a class="code" href="classisis_1_1data_1_1Chunk.html#acf9c5e0311d80bed02a16362e2e0fc42" title="Gets a reference to the element at a given index.">voxel</a>&lt;T&gt;( 0, 0, 0, 0 ) );
<a name="l00405"></a>00405         <span class="keywordflow">return</span> ret;
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00414"></a>00414     <span class="keywordtype">bool</span> <a class="code" href="classisis_1_1data_1_1Image.html#a582f927569aba48d8626c9a7d941ded1" title="Ensure, the image has the type with the requested ID.">convertToType</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ID );
<a name="l00415"></a>00415 
<a name="l00420"></a>00420     <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#a94fda5b511c9bfdff550d9691937aea1" title="Automatically splice the given dimension and all dimensions above.">spliceDownTo</a>( <a class="code" href="namespaceisis_1_1data.html#a157a8a81ce7fb08f84af9c27b7d251a3">dimensions</a> dim );
<a name="l00421"></a>00421 
<a name="l00428"></a>00428     <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#aac647fb29128d16d528059d481c79874" title="Run a functor with the base ChunkOp on every cunk in the image.">foreachChunk</a>( ChunkOp &amp;op, <span class="keywordtype">bool</span> copyMetaData = <span class="keyword">false</span> );
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 
<a name="l00438"></a><a class="code" href="classisis_1_1data_1_1Image.html#a3b22f8df84945fb3ff35788cb295f12d">00438</a>     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TYPE&gt; <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#a3b22f8df84945fb3ff35788cb295f12d" title="Run a functor with the base VoxelOp on every chunk in the image.">foreachVoxel</a>( <a class="code" href="classisis_1_1data_1_1Chunk_1_1VoxelOp.html">Chunk::VoxelOp&lt;TYPE&gt;</a> &amp;op ) {
<a name="l00439"></a>00439         <span class="keyword">class </span>_proxy: <span class="keyword">public</span> <a class="code" href="classisis_1_1data_1_1Image_1_1ChunkOp.html">ChunkOp</a>
<a name="l00440"></a>00440         {
<a name="l00441"></a>00441             <a class="code" href="classisis_1_1data_1_1Chunk_1_1VoxelOp.html">Chunk::VoxelOp&lt;TYPE&gt;</a> &amp;op;
<a name="l00442"></a>00442         <span class="keyword">public</span>:
<a name="l00443"></a>00443             _proxy( <a class="code" href="classisis_1_1data_1_1Chunk_1_1VoxelOp.html">Chunk::VoxelOp&lt;TYPE&gt;</a> &amp;_op ): op( _op ) {}
<a name="l00444"></a>00444             <span class="keywordtype">bool</span> operator()( <a class="code" href="classisis_1_1data_1_1Chunk.html" title="Main class for four-dimensional random-access data blocks.">Chunk</a> &amp;ch, <a class="code" href="classisis_1_1util_1_1FixedVector.html">util::FixedVector&lt;size_t, 4 &gt;</a> posInImage ) {
<a name="l00445"></a>00445                 <span class="keywordflow">return</span> ch.<a class="code" href="classisis_1_1data_1_1Chunk.html#af0439cc46bc1000ef0b3d8762a41d885" title="Run a functor on every Voxel in the chunk.">foreachVoxel</a>&lt;TYPE&gt;( op, posInImage ) == 0;
<a name="l00446"></a>00446             }
<a name="l00447"></a>00447         };
<a name="l00448"></a>00448         _proxy prx( op );
<a name="l00449"></a>00449         <span class="keywordflow">return</span> <a class="code" href="classisis_1_1data_1_1Image.html#a582f927569aba48d8626c9a7d941ded1" title="Ensure, the image has the type with the requested ID.">convertToType</a>( <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">data::ValuePtr&lt;TYPE&gt;::staticID</a> ) &amp;&amp; <a class="code" href="classisis_1_1data_1_1Image.html#aac647fb29128d16d528059d481c79874" title="Run a functor with the base ChunkOp on every cunk in the image.">foreachChunk</a>( prx, <span class="keyword">false</span> );
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451 
<a name="l00453"></a>00453     <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#ace627e4628e39615cbae3b6b43b9d915">getNrOfRows</a>()<span class="keyword">const</span>;
<a name="l00455"></a>00455     <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#a7db53938ebc559528240a73b24736d81">getNrOfColumms</a>()<span class="keyword">const</span>;
<a name="l00457"></a>00457     <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#a922ea56dd2eb60fbb6e0299138dcde70">getNrOfSlices</a>()<span class="keyword">const</span>;
<a name="l00459"></a>00459     <span class="keywordtype">size_t</span> <a class="code" href="classisis_1_1data_1_1Image.html#a142c7b80e200d9822c28fc604bb031ee">getNrOfTimesteps</a>()<span class="keyword">const</span>;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <a class="code" href="classisis_1_1util_1_1vector4.html">util::fvector4</a> <a class="code" href="classisis_1_1data_1_1Image.html#a36e107da6a3d4744468b3c837534291b">getFoV</a>()<span class="keyword">const</span>;
<a name="l00462"></a>00462 };
<a name="l00463"></a>00463 
<a name="l00468"></a><a class="code" href="classisis_1_1data_1_1TypedImage.html">00468</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span><a class="code" href="classisis_1_1data_1_1TypedImage.html" title="An Image where all chunks are guaranteed to have a specific type.">TypedImage</a>: <span class="keyword">public</span> <a class="code" href="classisis_1_1data_1_1Image.html">Image</a>
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470 <span class="keyword">protected</span>:
<a name="l00471"></a><a class="code" href="classisis_1_1data_1_1TypedImage.html#a071c1e7c3fe1b6e274b7330921b4f29c">00471</a>     <a class="code" href="classisis_1_1data_1_1TypedImage.html#a071c1e7c3fe1b6e274b7330921b4f29c">TypedImage</a>() {} <span class="comment">// to be used only by inheriting classes</span>
<a name="l00472"></a>00472 <span class="keyword">public</span>:
<a name="l00474"></a><a class="code" href="classisis_1_1data_1_1TypedImage.html#a05f095de7c8b6146f067769591d7f0c5">00474</a>     <a class="code" href="classisis_1_1data_1_1TypedImage.html#a05f095de7c8b6146f067769591d7f0c5" title="cheap copy another Image and make sure all chunks have type T">TypedImage</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Image.html">Image</a> &amp;src ): <a class="code" href="classisis_1_1data_1_1Image.html">Image</a>( src ) { <span class="comment">// ok we just copied the whole image</span>
<a name="l00475"></a>00475         <span class="comment">//but we want it to be of type T</span>
<a name="l00476"></a>00476         <a class="code" href="classisis_1_1data_1_1Image.html#a582f927569aba48d8626c9a7d941ded1" title="Ensure, the image has the type with the requested ID.">convertToType</a>( <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">ValuePtr&lt;T&gt;::staticID</a> );
<a name="l00477"></a>00477     }
<a name="l00479"></a><a class="code" href="classisis_1_1data_1_1TypedImage.html#a39da1b4e2f0785e43efa6a3a797e416b">00479</a>     <a class="code" href="classisis_1_1data_1_1TypedImage.html" title="An Image where all chunks are guaranteed to have a specific type.">TypedImage</a> &amp;<a class="code" href="classisis_1_1data_1_1TypedImage.html#a39da1b4e2f0785e43efa6a3a797e416b" title="cheap copy another TypedImage">operator=</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1TypedImage.html" title="An Image where all chunks are guaranteed to have a specific type.">TypedImage</a> &amp;ref ) { <span class="comment">//its already of the given type - so just copy it</span>
<a name="l00480"></a>00480         <a class="code" href="classisis_1_1data_1_1TypedImage.html#a39da1b4e2f0785e43efa6a3a797e416b" title="cheap copy another TypedImage">Image::operator=</a>( ref );
<a name="l00481"></a>00481         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00482"></a>00482     }
<a name="l00484"></a><a class="code" href="classisis_1_1data_1_1TypedImage.html#a16654e67097e9e70a1bcc16b84bdd640">00484</a>     <a class="code" href="classisis_1_1data_1_1TypedImage.html" title="An Image where all chunks are guaranteed to have a specific type.">TypedImage</a> &amp;<a class="code" href="classisis_1_1data_1_1TypedImage.html#a16654e67097e9e70a1bcc16b84bdd640" title="cheap copy another Image and make sure all chunks have type T">operator=</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Image.html">Image</a> &amp;ref ) { <span class="comment">// copy the image, and make sure its of the given type</span>
<a name="l00485"></a>00485         <a class="code" href="classisis_1_1data_1_1TypedImage.html#a39da1b4e2f0785e43efa6a3a797e416b" title="cheap copy another TypedImage">Image::operator=</a>( ref );
<a name="l00486"></a>00486         <a class="code" href="classisis_1_1data_1_1Image.html#a582f927569aba48d8626c9a7d941ded1" title="Ensure, the image has the type with the requested ID.">convertToType</a>( <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">ValuePtr&lt;T&gt;::staticID</a> );
<a name="l00487"></a>00487         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00488"></a>00488     }
<a name="l00489"></a><a class="code" href="classisis_1_1data_1_1TypedImage.html#a32b8263ed887ddf4ad21fdb35796aacd">00489</a>     <span class="keywordtype">void</span> <a class="code" href="classisis_1_1data_1_1TypedImage.html#a32b8263ed887ddf4ad21fdb35796aacd">copyToMem</a>( <span class="keywordtype">void</span> *dst ) {
<a name="l00490"></a>00490         Image::copyToMem&lt;T&gt;( ( T * )dst );
<a name="l00491"></a>00491     }
<a name="l00492"></a><a class="code" href="classisis_1_1data_1_1TypedImage.html#aa76b45b6e85fa810e63b472bde5f25f8">00492</a>     <span class="keywordtype">void</span> <a class="code" href="classisis_1_1data_1_1TypedImage.html#aa76b45b6e85fa810e63b472bde5f25f8">copyToMem</a>( <span class="keywordtype">void</span> *dst )<span class="keyword">const </span>{
<a name="l00493"></a>00493         Image::copyToMem&lt;T&gt;( ( T * )dst );
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495 };
<a name="l00496"></a>00496 
<a name="l00501"></a><a class="code" href="classisis_1_1data_1_1MemImage.html">00501</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span><a class="code" href="classisis_1_1data_1_1MemImage.html" title="An Image which always uses its own memory and a specific type.">MemImage</a>: <span class="keyword">public</span> <a class="code" href="classisis_1_1data_1_1TypedImage.html" title="An Image where all chunks are guaranteed to have a specific type.">TypedImage</a>&lt;T&gt;
<a name="l00502"></a>00502 {
<a name="l00503"></a>00503 <span class="keyword">public</span>:
<a name="l00509"></a><a class="code" href="classisis_1_1data_1_1MemImage.html#a7bcae94f698adcb22d4ec30b8075d40b">00509</a>     <a class="code" href="classisis_1_1data_1_1MemImage.html#a7bcae94f698adcb22d4ec30b8075d40b" title="Copy contructor.">MemImage</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Image.html">Image</a> &amp;src ) {
<a name="l00510"></a>00510         <a class="code" href="classisis_1_1data_1_1MemImage.html#a734d63e8c8c9d1eec740522451662f7f" title="Copy operator.">operator=</a>( src );
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512 
<a name="l00518"></a><a class="code" href="classisis_1_1data_1_1MemImage.html#a734d63e8c8c9d1eec740522451662f7f">00518</a>     <a class="code" href="classisis_1_1data_1_1MemImage.html" title="An Image which always uses its own memory and a specific type.">MemImage</a> &amp;<a class="code" href="classisis_1_1data_1_1MemImage.html#a734d63e8c8c9d1eec740522451662f7f" title="Copy operator.">operator=</a>( <span class="keyword">const</span> <a class="code" href="classisis_1_1data_1_1Image.html">Image</a> &amp;ref ) { <span class="comment">// copy the image, and make sure its of the given type</span>
<a name="l00519"></a>00519 
<a name="l00520"></a>00520         <a class="code" href="classisis_1_1data_1_1MemImage.html#a734d63e8c8c9d1eec740522451662f7f" title="Copy operator.">Image::operator=</a>( ref ); <span class="comment">// ok we just copied the whole image</span>
<a name="l00521"></a>00521 
<a name="l00522"></a>00522         <span class="comment">//we want deep copies of the chunks, and we want them to be of type T</span>
<a name="l00523"></a>00523         <span class="keyword">struct </span>: _internal::SortedChunkList::chunkPtrOperator {
<a name="l00524"></a>00524             std::pair&lt;util::ValueReference, util::ValueReference&gt; scale;
<a name="l00525"></a>00525             boost::shared_ptr&lt;Chunk&gt; operator()( <span class="keyword">const</span> boost::shared_ptr&lt; Chunk &gt;&amp; ptr ) {
<a name="l00526"></a>00526                 <span class="keywordflow">return</span> boost::shared_ptr&lt;Chunk&gt;( <span class="keyword">new</span> <a class="code" href="classisis_1_1data_1_1MemChunk.html" title="Chunk class for memory-based buffers.">MemChunk&lt;T&gt;</a>( *ptr, scale ) );
<a name="l00527"></a>00527             }
<a name="l00528"></a>00528         } conv_op;
<a name="l00529"></a>00529         conv_op.scale = ref.<a class="code" href="classisis_1_1data_1_1Image.html#a789138e66345f3e5a73c65dbf05b2940" title="for each chunk get the scaling (and offset) which would be used in an conversion to the given type...">getScalingTo</a>( <a class="code" href="classisis_1_1data_1_1ValuePtr.html" title="Generic class for type (and length) - aware pointers.">ValuePtr&lt;T&gt;::staticID</a> );
<a name="l00530"></a>00530         <a class="code" href="log_8hpp.html#adf04aa30f03b88d867f551c7d349f738">LOG</a>( <a class="code" href="namespaceisis_1_1data.html#a1fa5e73edba41053e31839cba7134dbd">Debug</a>, <a class="code" href="group__util.html#ggafe55030315ca143f9be26fd278df9f82ad97a38c0fafe61d63fdb883c85d0067a">info</a> ) &lt;&lt; <span class="stringliteral">&quot;Computed scaling for conversion from source image: [&quot;</span> &lt;&lt; conv_op.scale &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532         this-&gt;<span class="keyword">set</span>.transform( conv_op );
<a name="l00533"></a>00533         this-&gt;<a class="code" href="classisis_1_1data_1_1Image.html#a9c80a4fa8768d5df1c8bf67129e2cae9">lookup</a> = this-&gt;<span class="keyword">set</span>.getLookup(); <span class="comment">// the lookup table still points to the old chunks</span>
<a name="l00534"></a>00534         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536 };
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 <span class="preprocessor">#endif // IMAGE_H</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Apr 19 2011 16:19:15 for ISIS Core Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
